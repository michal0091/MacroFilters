<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to MacroFilters • MacroFilters</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to MacroFilters">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MacroFilters</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction to MacroFilters</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/michal0091/MacroFilters/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to MacroFilters</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/michal0091/MacroFilters/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/michal0091/MacroFilters" class="external-link">MacroFilters</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<hr>
<div class="section level2">
<h2 id="introduction-trend-cycle-decomposition">1. Introduction: Trend-Cycle Decomposition<a class="anchor" aria-label="anchor" href="#introduction-trend-cycle-decomposition"></a>
</h2>
<p>A fundamental task in applied macroeconomics is separating the
<em>trend</em> — the long-run trajectory of a variable — from the
<em>cycle</em> — transitory deviations around it. This decomposition
underpins business-cycle analysis, the output gap, and potential GDP
estimation.</p>
<p>Every series can be written as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><msub><mi>τ</mi><mi>t</mi></msub><mo>+</mo><msub><mi>c</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">
y_t = \tau_t + c_t
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\tau_t</annotation></semantics></math>
is the trend and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mi>t</mi></msub><annotation encoding="application/x-tex">c_t</annotation></semantics></math>
is the cyclical component. The challenge is that any filter must decide
whether an unusual observation represents a <em>genuine shock to the
trend</em> or a <em>transitory deviation that belongs in the
cycle</em>.</p>
<div class="section level3">
<h3 id="the-outlier-problem">The outlier problem<a class="anchor" aria-label="anchor" href="#the-outlier-problem"></a>
</h3>
<p>Classical filters minimise squared loss. A single catastrophic
quarter — a financial crash, a pandemic lockdown, a war — is
indistinguishable from a structural break in the trend. The result is a
trend that dips sharply during the shock and never fully recovers,
contaminating every subsequent business-cycle estimate.</p>
<p><strong>MacroFilters</strong> solves this with the
<code><a href="../reference/mbh_filter.html">mbh_filter()</a></code> function, which uses Huber loss to
automatically down-weight extreme observations while fitting a smooth
trend via gradient boosting.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="input-agnosticism-bring-your-own-class">2. Input Agnosticism: Bring Your Own Class<a class="anchor" aria-label="anchor" href="#input-agnosticism-bring-your-own-class"></a>
</h2>
<p>Many filter packages force you to convert data to a specific
time-series class before calling them. <strong>MacroFilters</strong>
accepts whatever you have and returns the result in the <em>same
format</em>, with no manual coercion required.</p>
<p>Supported input classes:</p>
<table class="table">
<thead><tr class="header">
<th>Class</th>
<th>Package</th>
<th>Example</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>numeric</code></td>
<td>base R</td>
<td><code>c(100, 102, 98, ...)</code></td>
</tr>
<tr class="even">
<td><code>ts</code></td>
<td>base R</td>
<td><code>ts(y, start = c(2000, 1), frequency = 4)</code></td>
</tr>
<tr class="odd">
<td><code>xts</code></td>
<td>xts</td>
<td><code>xts(y, order.by = dates)</code></td>
</tr>
<tr class="even">
<td><code>zoo</code></td>
<td>zoo</td>
<td><code>zoo(y, order.by = dates)</code></td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="example-same-filter-two-input-formats">Example: same filter, two input formats<a class="anchor" aria-label="anchor" href="#example-same-filter-two-input-formats"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">y_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.3</span>   <span class="co"># a simple integrated series</span></span>
<span></span>
<span><span class="co"># As plain numeric</span></span>
<span><span class="va">hp_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hp_filter.html">hp_filter</a></span><span class="op">(</span><span class="va">y_raw</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Cannot determine series frequency; assuming quarterly (freq = 4). Pass</span></span>
<span><span class="co">#&gt; `lambda` or `freq` explicitly to silence this warning.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">hp_num</span><span class="op">$</span><span class="va">trend</span><span class="op">)</span>   <span class="co"># numeric</span></span>
<span><span class="co">#&gt; [1] "numeric"</span></span>
<span></span>
<span><span class="co"># As a monthly ts object</span></span>
<span><span class="va">y_ts</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="va">y_raw</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">1</span><span class="op">)</span>, frequency <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">hp_ts</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hp_filter.html">hp_filter</a></span><span class="op">(</span><span class="va">y_ts</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">hp_ts</span><span class="op">$</span><span class="va">trend</span><span class="op">)</span>    <span class="co"># ts — output matches input</span></span>
<span><span class="co">#&gt; [1] "numeric"</span></span></code></pre></div>
<p>The filters normalise the input internally, perform all computations
on a plain numeric vector, then restore the original class and index
before returning.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="the-filter-arsenal">3. The Filter Arsenal<a class="anchor" aria-label="anchor" href="#the-filter-arsenal"></a>
</h2>
<div class="section level3">
<h3 id="hp_filter-sparse-hodrick-prescott">3.1 <code>hp_filter()</code> — Sparse Hodrick-Prescott<a class="anchor" aria-label="anchor" href="#hp_filter-sparse-hodrick-prescott"></a>
</h3>
<p>The Hodrick-Prescott (1997) filter is the workhorse of macroeconomic
trend extraction. It solves the penalised least-squares problem:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo>min</mo><mi>τ</mi></munder><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>τ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>+</mo><mi>λ</mi><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>2</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></munderover><msup><mrow><mo stretchy="true" form="prefix">[</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>τ</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>τ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>τ</mi><mi>t</mi></msub><mo>−</mo><msub><mi>τ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">
\min_{\tau} \sum_{t=1}^{n}(y_t - \tau_t)^2 + \lambda \sum_{t=2}^{n-1}[(\tau_{t+1} - \tau_t) - (\tau_t - \tau_{t-1})]^2
</annotation></semantics></math></p>
<p>The second term penalises curvature in the trend;
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
controls the smoothness.</p>
<p>Most implementations solve this by inverting a dense
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n \times n</annotation></semantics></math>
matrix, which is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math>.
<strong>MacroFilters</strong> recognises that the penalty matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>′</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">D'D</annotation></semantics></math>
is <em>pentadiagonal</em> (a sparse banded structure) and solves the
system using <code><a href="https://rdrr.io/pkg/Matrix/man/bandSparse.html" class="external-link">Matrix::bandSparse()</a></code> and sparse Cholesky
factorisation — bringing the cost down to <strong>O(n)</strong> in time
and memory.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n</span>  <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">y</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">/</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>         start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">1</span><span class="op">)</span>, frequency <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hp_filter.html">hp_filter</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">hp</span></span>
<span><span class="co">#&gt; -- MacroFilter [HP] --</span></span>
<span><span class="co">#&gt;    Observations : 100</span></span>
<span><span class="co">#&gt;    Parameters   : lambda = 1600</span></span>
<span><span class="co">#&gt;    Cycle range  : [-7.738, 9.143]  sd = 3.897</span></span>
<span><span class="co">#&gt;    Compute time : 0.002 s</span></span></code></pre></div>
<p>The smoothing parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
is auto-selected from the series frequency via the Ravn-Uhlig (2002)
heuristic:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>=</mo><mn>6.25</mn><mo>×</mo><msup><mtext mathvariant="normal">freq</mtext><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">
\lambda = 6.25 \times \text{freq}^4
</annotation></semantics></math></p>
<p>which gives
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>600</mn></mrow><annotation encoding="application/x-tex">\lambda = 1{,}600</annotation></semantics></math>
for quarterly and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>=</mo><mn>129</mn><mo>,</mo><mn>600</mn></mrow><annotation encoding="application/x-tex">\lambda = 129{,}600</annotation></semantics></math>
for monthly data — the conventional values. You can override it
explicitly: <code>hp_filter(y, lambda = 1600)</code>.</p>
<p><img src="introduction_files/figure-html/hp-plot-1.png" class="r-plt" alt="" width="100%"></p>
<p><img src="introduction_files/figure-html/hp-cycle-plot-1.png" class="r-plt" alt="" width="100%"></p>
<hr>
</div>
<div class="section level3">
<h3 id="hamilton_filter-regression-based-alternative">3.2 <code>hamilton_filter()</code> — Regression-Based
Alternative<a class="anchor" aria-label="anchor" href="#hamilton_filter-regression-based-alternative"></a>
</h3>
<p>Hamilton (2018) proposes replacing the HP filter entirely with an OLS
regression. The idea: project
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>t</mi><mo>+</mo><mi>h</mi></mrow></msub><annotation encoding="application/x-tex">y_{t+h}</annotation></semantics></math>
on a constant and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
lags of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>t</mi></msub><annotation encoding="application/x-tex">y_t</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>t</mi><mo>+</mo><mi>h</mi></mrow></msub><mo>=</mo><msub><mi>α</mi><mn>0</mn></msub><mo>+</mo><msub><mi>α</mi><mn>1</mn></msub><msub><mi>y</mi><mi>t</mi></msub><mo>+</mo><msub><mi>α</mi><mn>2</mn></msub><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>⋯</mi><mo>+</mo><msub><mi>α</mi><mi>p</mi></msub><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mi>p</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>c</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">
y_{t+h} = \alpha_0 + \alpha_1 y_t + \alpha_2 y_{t-1} + \cdots + \alpha_p y_{t-p+1} + c_t
</annotation></semantics></math></p>
<p>The fitted values form the trend; the residuals form the cycle. The
horizon
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
is set to two years ahead by default (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">h = 8</annotation></semantics></math>
quarters), long enough to capture business-cycle variation without
filtering it out.</p>
<p><strong>Advantages over HP:</strong> - No end-point distortion - No
spurious cycles from integrated series - Produces stationary cycle
estimates by construction</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ham</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hamilton_filter.html">hamilton_filter</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>      <span class="co"># auto-detects h = 8 for quarterly</span></span>
<span><span class="va">ham</span></span>
<span><span class="co">#&gt; -- MacroFilter [Hamilton] --</span></span>
<span><span class="co">#&gt;    Observations : 100</span></span>
<span><span class="co">#&gt;    Parameters   : h = 8, p = 4</span></span>
<span><span class="co">#&gt;    Cycle range  : [-13.41, 11.8]  sd = 7.212</span></span>
<span><span class="co">#&gt;    Compute time : 0.000 s</span></span></code></pre></div>
<p>Note that the first
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>+</mo><mi>p</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">h + p - 1</annotation></semantics></math>
observations of the trend and cycle are <code>NA</code>, because there
is insufficient history for the regression.</p>
<hr>
</div>
<div class="section level3">
<h3 id="bhp_filter-boosted-hp">3.3 <code>bhp_filter()</code> — Boosted HP<a class="anchor" aria-label="anchor" href="#bhp_filter-boosted-hp"></a>
</h3>
<p>Phillips &amp; Shi (2021) propose iteratively applying the HP filter:
at each step, the filter is re-run on the <em>residuals</em> from the
previous pass, and the resulting increment is added to the trend
estimate. This procedure converges to a trend that better tracks
stochastic variation.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>τ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>=</mo><msup><mi>τ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>+</mo><msub><mi>S</mi><mi>λ</mi></msub><mo>⋅</mo><msup><mi>c</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><mspace width="2.0em"></mspace><msup><mi>c</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>=</mo><mi>y</mi><mo>−</mo><msup><mi>τ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">
\tau^{(m)} = \tau^{(m-1)} + S_\lambda \cdot c^{(m-1)}, \qquad c^{(m)} = y - \tau^{(m)}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>S</mi><mi>λ</mi></msub><annotation encoding="application/x-tex">S_\lambda</annotation></semantics></math>
is the HP smoothing operator. Three stopping rules are available:</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Rule</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<code>"bic"</code> (default)</td>
<td>Minimise the Schwarz information criterion</td>
</tr>
<tr class="even">
<td><code>"adf"</code></td>
<td>Stop when the cycle passes an Augmented Dickey-Fuller stationarity
test</td>
</tr>
<tr class="odd">
<td><code>"fixed"</code></td>
<td>Run exactly <code>iter_max</code> iterations</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bhp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bhp_filter.html">bhp_filter</a></span><span class="op">(</span><span class="va">y</span>, stopping <span class="op">=</span> <span class="st">"bic"</span><span class="op">)</span></span>
<span><span class="va">bhp</span></span>
<span><span class="co">#&gt; -- MacroFilter [bHP] --</span></span>
<span><span class="co">#&gt;    Observations : 100</span></span>
<span><span class="co">#&gt;    Parameters   : lambda = 1600, iterations = 47, stopping_rule = bic</span></span>
<span><span class="co">#&gt;    Cycle range  : [-5.487, 4.068]  sd = 1.857</span></span>
<span><span class="co">#&gt;    Compute time : 0.004 s</span></span></code></pre></div>
<p>Internally, <strong>MacroFilters</strong> precomputes the sparse
penalty matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>I</mi><mo>+</mo><mi>λ</mi><mi>D</mi><mi>′</mi><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">Q = (I + \lambda D'D)^{-1}</annotation></semantics></math>
once and reuses it across all iterations, so the cost per iteration is a
single sparse matrix–vector multiply rather than a full solve.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="the-crown-jewel-mbh_filter">4. The Crown Jewel: <code>mbh_filter()</code><a class="anchor" aria-label="anchor" href="#the-crown-jewel-mbh_filter"></a>
</h2>
<div class="section level3">
<h3 id="the-problem-with-squared-loss">The Problem with Squared Loss<a class="anchor" aria-label="anchor" href="#the-problem-with-squared-loss"></a>
</h3>
<p>Every filter above minimises squared residuals. When a pandemic shock
drops GDP by 15% in a single quarter, that one observation exerts
enormous leverage — it is 100× more influential than a typical quarterly
fluctuation. The filter accommodates it by <em>bending the trend
downward</em>, producing a spurious trend break that infects every
subsequent output gap estimate.</p>
</div>
<div class="section level3">
<h3 id="the-mbh-solution-huber-loss-boosting">The MBH Solution: Huber Loss + Boosting<a class="anchor" aria-label="anchor" href="#the-mbh-solution-huber-loss-boosting"></a>
</h3>
<p>The <strong>MacroBoost Hybrid (MBH)</strong> filter replaces squared
loss with <strong>Huber loss</strong>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mi>δ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mfrac displaystyle="true"><msup><mi>r</mi><mn>2</mn></msup><mn>2</mn></mfrac></mtd><mtd columnalign="left" style="text-align: left"><mrow><mo stretchy="true" form="prefix">|</mo><mi>r</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>≤</mo><mi>δ</mi></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mi>δ</mi><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">|</mo><mi>r</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>−</mo><mfrac displaystyle="true"><mi>δ</mi><mn>2</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mrow><mo stretchy="true" form="prefix">|</mo><mi>r</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>&gt;</mo><mi>δ</mi></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
L_\delta(r) = \begin{cases}
\dfrac{r^2}{2} &amp; |r| \leq \delta \\[6pt]
\delta\!\left(|r| - \dfrac{\delta}{2}\right) &amp; |r| &gt; \delta
\end{cases}
</annotation></semantics></math></p>
<p>Observations with residuals smaller than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>
are treated like ordinary squared-error observations. Observations with
residuals larger than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>
— the structural shocks — contribute only <em>linearly</em>, massively
reducing their influence on the trend estimate.</p>
</div>
<div class="section level3">
<h3 id="additive-model">Additive Model<a class="anchor" aria-label="anchor" href="#additive-model"></a>
</h3>
<p>The trend is decomposed into two additive base learners fitted via
<strong>component-wise L2-boosting</strong> (<code>mboost</code>):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>τ</mi><mo accent="true">̂</mo></mover><mi>t</mi></msub><mo>=</mo><munder><munder><mrow><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo>⋅</mo><mi>t</mi></mrow><mo accent="true">⏟</mo></munder><mtext mathvariant="normal">Global linear drift</mtext></munder><mo>+</mo><munder><munder><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mo accent="true">⏟</mo></munder><mtext mathvariant="normal">Local curvature (P-spline)</mtext></munder></mrow><annotation encoding="application/x-tex">
\hat{\tau}_t = \underbrace{b_0 + b_1 \cdot t}_{\text{Global linear drift}} + \underbrace{f(t)}_{\text{Local curvature (P-spline)}}
</annotation></semantics></math></p>
<ul>
<li>
<strong><code>bols(time, intercept = TRUE)</code></strong> —
captures the global linear drift.</li>
<li>
<strong><code>bbs(time, knots, degree = 3, differences = 2)</code></strong>
— a cubic P-spline with <code>knots</code> interior knots that captures
smooth nonlinear curvature.</li>
</ul>
<p>The default <code>knots = max(20, floor(n/2))</code> is deliberately
generous — it gives the spline enough flexibility to follow genuine
low-frequency movements without overfitting, while the Huber loss
ensures that shock-contaminated quarters are downweighted.</p>
</div>
<div class="section level3">
<h3 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Parameter</th>
<th>Default</th>
<th>Role</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>knots</code></td>
<td><code>max(20, n/2)</code></td>
<td>P-spline flexibility — higher = more local adaptability</td>
</tr>
<tr class="even">
<td><code>mstop</code></td>
<td><code>500</code></td>
<td>Boosting iterations — more = finer approximation</td>
</tr>
<tr class="odd">
<td><code>d</code></td>
<td><code>NULL (Auto)</code></td>
<td>Huber delta — if <code>NULL</code>, auto-set via MAD of first
differences (scale-invariant)</td>
</tr>
<tr class="even">
<td><code>nu</code></td>
<td><code>0.2</code></td>
<td>Shrinkage / learning rate — controls step size per iteration</td>
</tr>
</tbody>
</table>
<p>By default, <code>d</code> is auto-calibrated using the MAD of the
series’ first differences, making the filter scale-invariant and
suitable for both log-differenced and level series. You can override it
with an explicit numeric value: <code>d = 0.01</code> is typical for
growth rates, while <code>d = 5</code> to <code>d = 20</code> may be
needed for index-level series.</p>
</div>
<div class="section level3">
<h3 id="quick-example">Quick example<a class="anchor" aria-label="anchor" href="#quick-example"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">80</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span></span>
<span></span>
<span><span class="co"># 1. Define simulation parameters</span></span>
<span><span class="va">sd_noise</span> <span class="op">&lt;-</span> <span class="fl">1.8</span></span>
<span><span class="va">trend</span>    <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="va">t</span> <span class="op">+</span> <span class="fl">0.005</span> <span class="op">*</span> <span class="va">t</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">cycle</span>    <span class="op">&lt;-</span> <span class="fl">2.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="fl">28</span><span class="op">)</span> <span class="co"># 7-year business cycle</span></span>
<span></span>
<span><span class="co"># 2. Simulate GDP index</span></span>
<span><span class="va">gdp_num</span> <span class="op">&lt;-</span> <span class="va">trend</span> <span class="op">+</span> <span class="va">cycle</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="va">sd_noise</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Inject a structural shock (e.g., COVID-19 lockdown)</span></span>
<span><span class="co"># Expressed as extreme standard deviation events</span></span>
<span><span class="va">gdp_num</span><span class="op">[</span><span class="fl">60</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gdp_num</span><span class="op">[</span><span class="fl">60</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="fl">16</span> <span class="op">*</span> <span class="va">sd_noise</span><span class="op">)</span> <span class="co"># Massive crash</span></span>
<span><span class="va">gdp_num</span><span class="op">[</span><span class="fl">61</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gdp_num</span><span class="op">[</span><span class="fl">61</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="fl">9</span> <span class="op">*</span> <span class="va">sd_noise</span><span class="op">)</span>  <span class="co"># Partial recovery</span></span>
<span><span class="va">gdp_num</span><span class="op">[</span><span class="fl">62</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gdp_num</span><span class="op">[</span><span class="fl">62</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="va">sd_noise</span><span class="op">)</span>  <span class="co"># V Stabilization</span></span>
<span><span class="va">gdp_num</span><span class="op">[</span><span class="fl">62</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gdp_num</span><span class="op">[</span><span class="fl">62</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">sd_noise</span><span class="op">)</span>  <span class="co"># Stabilization</span></span>
<span></span>
<span><span class="va">gdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="va">gdp_num</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">1</span><span class="op">)</span>, frequency <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract trends</span></span>
<span><span class="va">hp_res</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hp_filter.html">hp_filter</a></span><span class="op">(</span><span class="va">gdp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># MBH Filter: Auto-calibrated threshold (d) based on MAD of differences</span></span>
<span><span class="va">mbh_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbh_filter.html">mbh_filter</a></span><span class="op">(</span><span class="va">gdp</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">mbh_res</span></span>
<span><span class="co">#&gt; -- MacroFilter [MBH] --</span></span>
<span><span class="co">#&gt;    Observations : 80</span></span>
<span><span class="co">#&gt;    Parameters   : knots = 40, d = 2.789, mstop = 500, mstop_initial = 500, nu = 0.1, df = 4, select_mstop = FALSE</span></span>
<span><span class="co">#&gt;    Cycle range  : [-26.64, 4.429]  sd = 4.087</span></span>
<span><span class="co">#&gt;    Compute time : 0.128 s</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/mbh-plot-1.png" class="r-plt" alt="" width="100%"></p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="the-macrofilter-s3-class">5. The <code>macrofilter</code> S3 Class<a class="anchor" aria-label="anchor" href="#the-macrofilter-s3-class"></a>
</h2>
<p>All four functions return an object of class
<code>macrofilter</code>. This is a list with three named elements:</p>
<table class="table">
<thead><tr class="header">
<th>Element</th>
<th>Type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>$trend</code></td>
<td>numeric / ts / xts / zoo</td>
<td>Trend component</td>
</tr>
<tr class="even">
<td><code>$cycle</code></td>
<td>numeric / ts / xts / zoo</td>
<td>Cyclical component</td>
</tr>
<tr class="odd">
<td><code>$data</code></td>
<td>numeric / ts / xts / zoo</td>
<td>Original series (immutable)</td>
</tr>
<tr class="even">
<td><code>$meta</code></td>
<td>named list</td>
<td>Filter method, parameters, compute time</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="printing">Printing<a class="anchor" aria-label="anchor" href="#printing"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mbh_res</span></span>
<span><span class="co">#&gt; -- MacroFilter [MBH] --</span></span>
<span><span class="co">#&gt;    Observations : 80</span></span>
<span><span class="co">#&gt;    Parameters   : knots = 40, d = 2.789, mstop = 500, mstop_initial = 500, nu = 0.1, df = 4, select_mstop = FALSE</span></span>
<span><span class="co">#&gt;    Cycle range  : [-26.64, 4.429]  sd = 4.087</span></span>
<span><span class="co">#&gt;    Compute time : 0.128 s</span></span></code></pre></div>
<p>The <code>print</code> method shows the method, the number of
observations, the key parameters, the cycle range, and how long the
filter took to run.</p>
</div>
<div class="section level3">
<h3 id="accessing-components">Accessing components<a class="anchor" aria-label="anchor" href="#accessing-components"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Trend and cycle as plain vectors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mbh_res</span><span class="op">$</span><span class="va">trend</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 103.5415 103.7764 104.0074 104.2300 104.4373 104.6223 104.7785 104.9015</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mbh_res</span><span class="op">$</span><span class="va">cycle</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.21246933 -3.08814252 -0.85000087  0.14375249  0.16777488 -0.39598786</span></span>
<span><span class="co">#&gt; [7]  2.78720646  0.08539543</span></span>
<span></span>
<span><span class="co"># Verify the fundamental identity: trend + cycle == data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="op">(</span><span class="va">mbh_res</span><span class="op">$</span><span class="va">trend</span> <span class="op">+</span> <span class="va">mbh_res</span><span class="op">$</span><span class="va">cycle</span><span class="op">)</span> <span class="op">-</span> <span class="va">mbh_res</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>  <span class="co"># should be &lt; 1e-9</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inspecting-metadata">Inspecting metadata<a class="anchor" aria-label="anchor" href="#inspecting-metadata"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mbh_res</span><span class="op">$</span><span class="va">meta</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 9</span></span>
<span><span class="co">#&gt;  $ method       : chr "MBH"</span></span>
<span><span class="co">#&gt;  $ knots        : int 40</span></span>
<span><span class="co">#&gt;  $ d            : num 2.79</span></span>
<span><span class="co">#&gt;  $ mstop        : int 500</span></span>
<span><span class="co">#&gt;  $ mstop_initial: int 500</span></span>
<span><span class="co">#&gt;  $ nu           : num 0.1</span></span>
<span><span class="co">#&gt;  $ df           : int 4</span></span>
<span><span class="co">#&gt;  $ select_mstop : logi FALSE</span></span>
<span><span class="co">#&gt;  $ compute_time : num 0.128</span></span></code></pre></div>
<p>The <code>meta</code> list stores every parameter used by the filter,
making results fully reproducible from the object alone — no need to
track arguments separately.</p>
</div>
<div class="section level3">
<h3 id="plotting-cycles-side-by-side">Plotting cycles side by side<a class="anchor" aria-label="anchor" href="#plotting-cycles-side-by-side"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_cycle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">gdp</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  HP_cycle   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">hp_res</span><span class="op">$</span><span class="va">cycle</span><span class="op">)</span>,</span>
<span>  MBH_cycle  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mbh_res</span><span class="op">$</span><span class="va">cycle</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_cycle</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, colour <span class="op">=</span> <span class="st">"grey40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">HP_cycle</span>,  colour <span class="op">=</span> <span class="st">"HP cycle"</span><span class="op">)</span>,  linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">MBH_cycle</span>, colour <span class="op">=</span> <span class="st">"MBH cycle"</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>,</span>
<span>           xmin <span class="op">=</span> <span class="va">df_cycle</span><span class="op">$</span><span class="va">t</span><span class="op">[</span><span class="fl">59</span><span class="op">]</span>, xmax <span class="op">=</span> <span class="va">df_cycle</span><span class="op">$</span><span class="va">t</span><span class="op">[</span><span class="fl">63</span><span class="op">]</span>,</span>
<span>           ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>           alpha <span class="op">=</span> <span class="fl">0.12</span>, fill <span class="op">=</span> <span class="st">"firebrick"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HP cycle"</span> <span class="op">=</span> <span class="st">"#0072B2"</span>, <span class="st">"MBH cycle"</span> <span class="op">=</span> <span class="st">"#E69F00"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"Cyclical Components"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"HP cycle absorbs the shock; MBH cycle faithfully records it"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Cycle"</span>, colour <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/cycle-comparison-1.png" class="r-plt" alt="" width="100%"></p>
<p>In the MBH cycle, the COVID quarters appear as large negative spikes
— the filter correctly recognises them as transitory deviations rather
than a change in the long-run level. The HP cycle, by contrast, spreads
the shock over several surrounding quarters as it tries to reconcile the
trend distortion.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Hodrick, R. J., &amp; Prescott, E. C. (1997). Postwar U.S. Business
Cycles: An Empirical Investigation. <em>Journal of Money, Credit and
Banking</em>, 29(1), 1–16.</li>
<li>Ravn, M. O., &amp; Uhlig, H. (2002). On Adjusting the
Hodrick-Prescott Filter for the Frequency of Observations. <em>Review of
Economics and Statistics</em>, 84(2), 371–376.</li>
<li>Hamilton, J. D. (2018). Why You Should Never Use the
Hodrick-Prescott Filter. <em>Review of Economics and Statistics</em>,
100(5), 831–843.</li>
<li>Phillips, P. C. B., &amp; Shi, Z. (2021). Boosting: Why You Can Use
the HP Filter. <em>International Economic Review</em>, 62(2),
521–570.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michal Kinel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
