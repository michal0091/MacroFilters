[{"path":"https://michal0091.github.io/MacroFilters/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2026 Michal Kinel Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"introduction-trend-cycle-decomposition","dir":"Articles","previous_headings":"","what":"1. Introduction: Trend-Cycle Decomposition","title":"Introduction to MacroFilters","text":"fundamental task applied macroeconomics separating trend — long-run trajectory variable — cycle — transitory deviations around . decomposition underpins business-cycle analysis, output gap, potential GDP estimation. Every series can written : yt=τt+ct y_t = \\tau_t + c_t τt\\tau_t trend ctc_t cyclical component. challenge filter must decide whether unusual observation represents genuine shock trend transitory deviation belongs cycle.","code":""},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"the-outlier-problem","dir":"Articles","previous_headings":"1. Introduction: Trend-Cycle Decomposition","what":"The outlier problem","title":"Introduction to MacroFilters","text":"Classical filters minimise squared loss. single catastrophic quarter — financial crash, pandemic lockdown, war — indistinguishable structural break trend. result trend dips sharply shock never fully recovers, contaminating every subsequent business-cycle estimate. MacroFilters solves mbh_filter() function, uses Huber loss automatically -weight extreme observations fitting smooth trend via gradient boosting.","code":""},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"input-agnosticism-bring-your-own-class","dir":"Articles","previous_headings":"","what":"2. Input Agnosticism: Bring Your Own Class","title":"Introduction to MacroFilters","text":"Many filter packages force convert data specific time-series class calling . MacroFilters accepts whatever returns result format, manual coercion required. Supported input classes:","code":""},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"example-same-filter-two-input-formats","dir":"Articles","previous_headings":"2. Input Agnosticism: Bring Your Own Class","what":"Example: same filter, two input formats","title":"Introduction to MacroFilters","text":"filters normalise input internally, perform computations plain numeric vector, restore original class index returning.","code":"set.seed(7) y_raw <- cumsum(rnorm(60)) + (1:60) * 0.3   # a simple integrated series  # As plain numeric hp_num <- hp_filter(y_raw) #> Warning: Cannot determine series frequency; assuming quarterly (freq = 4). Pass #> `lambda` or `freq` explicitly to silence this warning. class(hp_num$trend)   # numeric #> [1] \"numeric\"  # As a monthly ts object y_ts   <- ts(y_raw, start = c(2019, 1), frequency = 12) hp_ts  <- hp_filter(y_ts) class(hp_ts$trend)    # ts — output matches input #> [1] \"numeric\""},{"path":[]},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"hp_filter-sparse-hodrick-prescott","dir":"Articles","previous_headings":"3. The Filter Arsenal","what":"3.1 hp_filter() — Sparse Hodrick-Prescott","title":"Introduction to MacroFilters","text":"Hodrick-Prescott (1997) filter workhorse macroeconomic trend extraction. solves penalised least-squares problem: minτ∑t=1n(yt−τt)2+λ∑t=2n−1[(τt+1−τt)−(τt−τt−1)]2 \\min_{\\tau} \\sum_{t=1}^{n}(y_t - \\tau_t)^2 + \\lambda \\sum_{t=2}^{n-1}[(\\tau_{t+1} - \\tau_t) - (\\tau_t - \\tau_{t-1})]^2 second term penalises curvature trend; λ\\lambda controls smoothness. implementations solve inverting dense n×nn \\times n matrix, O(n3)O(n^3). MacroFilters recognises penalty matrix D′DD'D pentadiagonal (sparse banded structure) solves system using Matrix::bandSparse() sparse Cholesky factorisation — bringing cost O(n) time memory. smoothing parameter λ\\lambda auto-selected series frequency via Ravn-Uhlig (2002) heuristic: λ=6.25×freq4 \\lambda = 6.25 \\times \\text{freq}^4 gives λ=1,600\\lambda = 1{,}600 quarterly λ=129,600\\lambda = 129{,}600 monthly data — conventional values. can override explicitly: hp_filter(y, lambda = 1600).","code":"set.seed(42) n  <- 100 y  <- ts(100 + 0.4 * (1:n) + 5 * sin(2 * pi * (1:n) / 20) + rnorm(n, sd = 2),          start = c(2000, 1), frequency = 4)  hp <- hp_filter(y) hp #> -- MacroFilter [HP] -- #>    Observations : 100 #>    Parameters   : lambda = 1600 #>    Cycle range  : [-7.738, 9.143]  sd = 3.897 #>    Compute time : 0.003 s"},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"hamilton_filter-regression-based-alternative","dir":"Articles","previous_headings":"3. The Filter Arsenal","what":"3.2 hamilton_filter() — Regression-Based Alternative","title":"Introduction to MacroFilters","text":"Hamilton (2018) proposes replacing HP filter entirely OLS regression. idea: project yt+hy_{t+h} constant pp lags yty_t: yt+h=α0+α1yt+α2yt−1+⋯+αpyt−p+1+ct y_{t+h} = \\alpha_0 + \\alpha_1 y_t + \\alpha_2 y_{t-1} + \\cdots + \\alpha_p y_{t-p+1} + c_t fitted values form trend; residuals form cycle. horizon hh set two years ahead default (e.g., h=8h = 8 quarters), long enough capture business-cycle variation without filtering . Advantages HP: - end-point distortion - spurious cycles integrated series - Produces stationary cycle estimates construction Note first h+p−1h + p - 1 observations trend cycle NA, insufficient history regression.","code":"ham <- hamilton_filter(y)      # auto-detects h = 8 for quarterly ham #> -- MacroFilter [Hamilton] -- #>    Observations : 100 #>    Parameters   : h = 8, p = 4 #>    Cycle range  : [-13.41, 11.8]  sd = 7.212 #>    Compute time : 0.001 s"},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"bhp_filter-boosted-hp","dir":"Articles","previous_headings":"3. The Filter Arsenal","what":"3.3 bhp_filter() — Boosted HP","title":"Introduction to MacroFilters","text":"Phillips & Shi (2021) propose iteratively applying HP filter: step, filter re-run residuals previous pass, resulting increment added trend estimate. procedure converges trend better tracks stochastic variation. τ(m)=τ(m−1)+Sλ⋅c(m−1),c(m)=y−τ(m) \\tau^{(m)} = \\tau^{(m-1)} + S_\\lambda \\cdot c^{(m-1)}, \\qquad c^{(m)} = y - \\tau^{(m)} SλS_\\lambda HP smoothing operator. Three stopping rules available: Internally, MacroFilters precomputes sparse penalty matrix Q=(+λD′D)−1Q = (+ \\lambda D'D)^{-1} reuses across iterations, cost per iteration single sparse matrix–vector multiply rather full solve.","code":"bhp <- bhp_filter(y, stopping = \"bic\") bhp #> -- MacroFilter [bHP] -- #>    Observations : 100 #>    Parameters   : lambda = 1600, iterations = 47, stopping_rule = bic #>    Cycle range  : [-5.487, 4.068]  sd = 1.857 #>    Compute time : 0.004 s"},{"path":[]},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"the-problem-with-squared-loss","dir":"Articles","previous_headings":"4. The Crown Jewel: mbh_filter()","what":"The Problem with Squared Loss","title":"Introduction to MacroFilters","text":"Every filter minimises squared residuals. pandemic shock drops GDP 15% single quarter, one observation exerts enormous leverage — 100× influential typical quarterly fluctuation. filter accommodates bending trend downward, producing spurious trend break infects every subsequent output gap estimate.","code":""},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"the-mbh-solution-huber-loss-boosting","dir":"Articles","previous_headings":"4. The Crown Jewel: mbh_filter()","what":"The MBH Solution: Huber Loss + Boosting","title":"Introduction to MacroFilters","text":"MacroBoost Hybrid (MBH) filter replaces squared loss Huber loss: Lδ(r)={r22|r|≤δδ(|r|−δ2)|r|>δ L_\\delta(r) = \\begin{cases} \\dfrac{r^2}{2} & |r| \\leq \\delta \\\\[6pt] \\delta\\!\\left(|r| - \\dfrac{\\delta}{2}\\right) & |r| > \\delta \\end{cases} Observations residuals smaller δ\\delta treated like ordinary squared-error observations. Observations residuals larger δ\\delta — structural shocks — contribute linearly, massively reducing influence trend estimate.","code":""},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"additive-model","dir":"Articles","previous_headings":"4. The Crown Jewel: mbh_filter()","what":"Additive Model","title":"Introduction to MacroFilters","text":"trend decomposed two additive base learners fitted via component-wise L2-boosting (mboost): τ̂t=b0+b1⋅t⏟Global linear drift+f(t)⏟Local curvature (P-spline) \\hat{\\tau}_t = \\underbrace{b_0 + b_1 \\cdot t}_{\\text{Global linear drift}} + \\underbrace{f(t)}_{\\text{Local curvature (P-spline)}} bols(time, intercept = TRUE) — captures global linear drift. bbs(time, knots, degree = 3, differences = 2) — cubic P-spline knots interior knots captures smooth nonlinear curvature. default knots = max(20, floor(n/2)) deliberately generous — gives spline enough flexibility follow genuine low-frequency movements without overfitting, Huber loss ensures shock-contaminated quarters downweighted.","code":""},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"parameters","dir":"Articles","previous_headings":"4. The Crown Jewel: mbh_filter()","what":"Parameters","title":"Introduction to MacroFilters","text":"default, d auto-calibrated using MAD series’ first differences, making filter scale-invariant suitable log-differenced level series. can override explicit numeric value: d = 0.01 typical growth rates, d = 5 d = 20 may needed index-level series.","code":""},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"quick-example","dir":"Articles","previous_headings":"4. The Crown Jewel: mbh_filter()","what":"Quick example","title":"Introduction to MacroFilters","text":"","code":"set.seed(42) n <- 80 t <- 1:n  # 1. Define simulation parameters sd_noise <- 1.8 trend    <- 100 + 0.3 * t + 0.005 * t^2 cycle    <- 2.5 * sin(2 * pi * t / 28) # 7-year business cycle  # 2. Simulate GDP index gdp_num <- trend + cycle + rnorm(n, sd = sd_noise)  # 3. Inject a structural shock (e.g., COVID-19 lockdown) # Expressed as extreme standard deviation events gdp_num[60] <- gdp_num[60] - (16 * sd_noise) # Massive crash gdp_num[61] <- gdp_num[61] - (9 * sd_noise)  # Partial recovery gdp_num[62] <- gdp_num[62] - (4 * sd_noise)  # V Stabilization gdp_num[62] <- gdp_num[62] - (2 * sd_noise)  # Stabilization  gdp <- ts(gdp_num, start = c(2001, 1), frequency = 4)  # Extract trends hp_res  <- hp_filter(gdp)  # MBH Filter: Auto-calibrated threshold (d) based on MAD of differences mbh_res <- mbh_filter(gdp)   mbh_res #> -- MacroFilter [MBH] -- #>    Observations : 80 #>    Parameters   : knots = 40, d = 2.789, mstop = 500, mstop_initial = 500, nu = 0.1, df = 4, select_mstop = FALSE #>    Cycle range  : [-26.64, 4.429]  sd = 4.087 #>    Compute time : 0.135 s"},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"the-macrofilter-s3-class","dir":"Articles","previous_headings":"","what":"5. The macrofilter S3 Class","title":"Introduction to MacroFilters","text":"four functions return object class macrofilter. list three named elements:","code":""},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"printing","dir":"Articles","previous_headings":"5. The macrofilter S3 Class","what":"Printing","title":"Introduction to MacroFilters","text":"print method shows method, number observations, key parameters, cycle range, long filter took run.","code":"mbh_res #> -- MacroFilter [MBH] -- #>    Observations : 80 #>    Parameters   : knots = 40, d = 2.789, mstop = 500, mstop_initial = 500, nu = 0.1, df = 4, select_mstop = FALSE #>    Cycle range  : [-26.64, 4.429]  sd = 4.087 #>    Compute time : 0.135 s"},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"accessing-components","dir":"Articles","previous_headings":"5. The macrofilter S3 Class","what":"Accessing components","title":"Introduction to MacroFilters","text":"","code":"# Trend and cycle as plain vectors head(mbh_res$trend, 8) #> [1] 103.5415 103.7764 104.0074 104.2300 104.4373 104.6223 104.7785 104.9015 head(mbh_res$cycle, 8) #> [1] -0.21246933 -3.08814252 -0.85000087  0.14375249  0.16777488 -0.39598786 #> [7]  2.78720646  0.08539543  # Verify the fundamental identity: trend + cycle == data max(abs((mbh_res$trend + mbh_res$cycle) - mbh_res$data))  # should be < 1e-9 #> [1] 0"},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"inspecting-metadata","dir":"Articles","previous_headings":"5. The macrofilter S3 Class","what":"Inspecting metadata","title":"Introduction to MacroFilters","text":"meta list stores every parameter used filter, making results fully reproducible object alone — need track arguments separately.","code":"str(mbh_res$meta) #> List of 9 #>  $ method       : chr \"MBH\" #>  $ knots        : int 40 #>  $ d            : num 2.79 #>  $ mstop        : int 500 #>  $ mstop_initial: int 500 #>  $ nu           : num 0.1 #>  $ df           : int 4 #>  $ select_mstop : logi FALSE #>  $ compute_time : num 0.135"},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"plotting-cycles-side-by-side","dir":"Articles","previous_headings":"5. The macrofilter S3 Class","what":"Plotting cycles side by side","title":"Introduction to MacroFilters","text":"MBH cycle, COVID quarters appear large negative spikes — filter correctly recognises transitory deviations rather change long-run level. HP cycle, contrast, spreads shock several surrounding quarters tries reconcile trend distortion.","code":"df_cycle <- data.frame(   t          = as.numeric(time(gdp)),   HP_cycle   = as.numeric(hp_res$cycle),   MBH_cycle  = as.numeric(mbh_res$cycle) )  ggplot(df_cycle, aes(x = t)) +   geom_hline(yintercept = 0, linetype = \"dashed\", colour = \"grey40\") +   geom_line(aes(y = HP_cycle,  colour = \"HP cycle\"),  linewidth = 0.8) +   geom_line(aes(y = MBH_cycle, colour = \"MBH cycle\"), linewidth = 0.8) +   annotate(\"rect\",            xmin = df_cycle$t[59], xmax = df_cycle$t[63],            ymin = -Inf, ymax = Inf,            alpha = 0.12, fill = \"firebrick\") +   scale_colour_manual(values = c(\"HP cycle\" = \"#0072B2\", \"MBH cycle\" = \"#E69F00\")) +   labs(     title    = \"Cyclical Components\",     subtitle = \"HP cycle absorbs the shock; MBH cycle faithfully records it\",     x = \"Year\", y = \"Cycle\", colour = NULL   ) +   theme_minimal(base_size = 12) +   theme(legend.position = \"bottom\")"},{"path":"https://michal0091.github.io/MacroFilters/articles/introduction.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Introduction to MacroFilters","text":"Hodrick, R. J., & Prescott, E. C. (1997). Postwar U.S. Business Cycles: Empirical Investigation. Journal Money, Credit Banking, 29(1), 1–16. Ravn, M. O., & Uhlig, H. (2002). Adjusting Hodrick-Prescott Filter Frequency Observations. Review Economics Statistics, 84(2), 371–376. Hamilton, J. D. (2018). Never Use Hodrick-Prescott Filter. Review Economics Statistics, 100(5), 831–843. Phillips, P. C. B., & Shi, Z. (2021). Boosting: Can Use HP Filter. International Economic Review, 62(2), 521–570.","code":""},{"path":"https://michal0091.github.io/MacroFilters/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Michal Kinel. Author, maintainer.","code":""},{"path":"https://michal0091.github.io/MacroFilters/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Kinel M (2026). MacroFilters: Robust Trend-Cycle Decomposition Macroeconomic Time Series. R package version 0.0.0.9000, https://github.com/michal0091/MacroFilters.","code":"@Manual{,   title = {MacroFilters: Robust Trend-Cycle Decomposition for Macroeconomic Time Series},   author = {Michal Kinel},   year = {2026},   note = {R package version 0.0.0.9000},   url = {https://github.com/michal0091/MacroFilters}, }"},{"path":"https://michal0091.github.io/MacroFilters/index.html","id":"macrofilters-","dir":"","previous_headings":"","what":"Robust Trend-Cycle Decomposition for Macroeconomic Time Series","title":"Robust Trend-Cycle Decomposition for Macroeconomic Time Series","text":"MacroFilters unified, high-performance library extracting trend cycle components macroeconomic time series. combines classical filters (Hodrick-Prescott, Hamilton, Boosted HP) flagship algorithm, MacroBoost Hybrid (MBH) — gradient-boosting filter Huber loss immune structural shocks COVID-19, financial crises, wars. MacroFilters instead mFilter neverhpfilter? Speed: HP filter uses sparse-matrix Cholesky factorisation (Matrix), scaling O(n) instead dense O(n³) used implementations. Robustness: mbh_filter() replaces squared-error loss Huber loss, single extreme quarter can never distort years estimated trend. Input agnosticism: Pass plain numeric vector, ts, xts, zoo object — output always matches input class, manual coercion required.","code":""},{"path":"https://michal0091.github.io/MacroFilters/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Robust Trend-Cycle Decomposition for Macroeconomic Time Series","text":"","code":"# install.packages(\"devtools\") devtools::install_github(\"michal0091/MacroFilters\")"},{"path":[]},{"path":"https://michal0091.github.io/MacroFilters/index.html","id":"simulating-a-series-with-a-covid-19-shock","dir":"","previous_headings":"Quick Start","what":"Simulating a series with a COVID-19 shock","title":"Robust Trend-Cycle Decomposition for Macroeconomic Time Series","text":"","code":"library(MacroFilters) #> Registered S3 method overwritten by 'quantmod': #>   method            from #>   as.zoo.data.frame zoo  set.seed(42) n    <- 80                              # ~20 years of quarterly data time <- 1:n # Long-run trend + business-cycle noise y_true <- 100 + 0.5 * time + 3 * sin(2 * pi * time / 16) y      <- y_true + rnorm(n, sd = 1.2)  # Inject a sharp COVID-like contraction in period 60 y[60] <- y[60] - 22 y[61] <- y[61] - 15 y[62] <- y[62] -  6  gdp_ts <- ts(y, start = c(2001, 1), frequency = 4)"},{"path":"https://michal0091.github.io/MacroFilters/index.html","id":"extracting-the-trend-with-hp-and-mbh","dir":"","previous_headings":"Quick Start","what":"Extracting the trend with HP and MBH","title":"Robust Trend-Cycle Decomposition for Macroeconomic Time Series","text":"","code":"hp_result  <- hp_filter(gdp_ts) mbh_result <- mbh_filter(gdp_ts)  hp_result   # print S3 summary #> -- MacroFilter [HP] -- #>    Observations : 80 #>    Parameters   : lambda = 1600 #>    Cycle range  : [-22.44, 5.885]  sd = 4.043 #>    Compute time : 0.013 s mbh_result #> -- MacroFilter [MBH] -- #>    Observations : 80 #>    Parameters   : knots = 40, d = 2.021, mstop = 500, nu = 0.2 #>    Cycle range  : [-24.82, 4.681]  sd = 4.084 #>    Compute time : 0.054 s"},{"path":"https://michal0091.github.io/MacroFilters/index.html","id":"visualising-the-comparison","dir":"","previous_headings":"Quick Start","what":"Visualising the comparison","title":"Robust Trend-Cycle Decomposition for Macroeconomic Time Series","text":"HP trend dips noticeably shock window, treating extreme quarters meaningful information long-run level. MBH trend glides undisturbed — Huber loss -weights observations automatically.","code":"library(ggplot2)  quarters <- time(gdp_ts) df <- data.frame(   time   = as.numeric(quarters),   data   = as.numeric(gdp_ts),   HP     = as.numeric(hp_result$trend),   MBH    = as.numeric(mbh_result$trend) )  ggplot(df, aes(x = time)) +   geom_line(aes(y = data, colour = \"Observed\"),  linewidth = 0.6, linetype = \"dashed\") +   geom_line(aes(y = HP,   colour = \"HP trend\"),  linewidth = 1.0) +   geom_line(aes(y = MBH,  colour = \"MBH trend\"), linewidth = 1.0) +   annotate(\"rect\",            xmin = df$time[59], xmax = df$time[63],            ymin = -Inf, ymax = Inf,            alpha = 0.12, fill = \"firebrick\") +   annotate(\"text\",            x = df$time[61], y = max(df$data),            label = \"COVID shock\", vjust = -0.5,            size = 3.5, colour = \"firebrick\") +   scale_colour_manual(     values = c(\"Observed\" = \"grey60\", \"HP trend\" = \"#0072B2\", \"MBH trend\" = \"#E69F00\")   ) +   labs(     title   = \"Trend Extraction under a Structural Shock\",     subtitle = \"HP trend is pulled down by the shock; MBH trend remains smooth\",     x = \"Year\", y = \"GDP Index\", colour = NULL   ) +   theme_minimal(base_size = 13) +   theme(legend.position = \"bottom\")"},{"path":"https://michal0091.github.io/MacroFilters/index.html","id":"the-filter-arsenal","dir":"","previous_headings":"","what":"The Filter Arsenal","title":"Robust Trend-Cycle Decomposition for Macroeconomic Time Series","text":"functions return macrofilter S3 object. Access components $trend, $cycle, $meta.","code":""},{"path":"https://michal0091.github.io/MacroFilters/index.html","id":"further-reading","dir":"","previous_headings":"","what":"Further Reading","title":"Robust Trend-Cycle Decomposition for Macroeconomic Time Series","text":"See vignette(\"introduction\", package = \"MacroFilters\") full walkthrough covering input agnosticism, four filters, S3 print/meta interface.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/bhp_filter.html","id":null,"dir":"Reference","previous_headings":"","what":"Boosted HP Filter — bhp_filter","title":"Boosted HP Filter — bhp_filter","text":"Iteratively applies Hodrick-Prescott filter residuals better capture stochastic trends.  iteration HP smoother applied current residual resulting trend increment added cumulative trend estimate.  Iteration stops according one three rules: BIC minimisation (default), ADF stationarity test residuals, fixed number iterations.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/bhp_filter.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Boosted HP Filter — bhp_filter","text":"","code":"bhp_filter(   x,   lambda = NULL,   iter_max = 100L,   stopping = c(\"bic\", \"adf\", \"fixed\"),   sig_level = 0.05,   freq = NULL )"},{"path":"https://michal0091.github.io/MacroFilters/reference/bhp_filter.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Boosted HP Filter — bhp_filter","text":"x Numeric vector, ts, xts, zoo object. lambda Smoothing parameter. NULL (default), auto-detected using Ravn-Uhlig rule (6.25 * freq^4). iter_max Integer. Maximum number boosting iterations (default 100). stopping Character. Stopping rule: \"bic\" (default), \"adf\", \"fixed\". sig_level Numeric. Significance level ADF test stopping = \"adf\" (default 0.05). freq Numeric frequency override (1 = annual, 4 = quarterly, 12 = monthly). Used lambda NULL frequency inferred x.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/bhp_filter.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Boosted HP Filter — bhp_filter","text":"macrofilter object trend, cycle, data, meta components.  meta list contains method = \"bHP\", lambda, iterations, stopping_rule, compute_time.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/bhp_filter.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Boosted HP Filter — bhp_filter","text":"boosted HP filter starts standard HP solution re-applies HP smoother residual (cycle) component.  trend increment pass accumulated, procedure stops one following criteria met: \"bic\" Schwarz information criterion computed \\(n \\log(\\hat\\sigma^2) + \\log(n)\\,\\mathrm{tr}(S^m)\\), \\(S^m\\) iterated smoother.  Iteration stops BIC increases relative previous best. \"adf\" Augmented Dickey-Fuller test residual.  Iteration stops residual stationary level sig_level. \"fixed\" Runs exactly iter_max iterations.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/bhp_filter.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Boosted HP Filter — bhp_filter","text":"Phillips, P.C.B. Shi, Z. (2021). Boosting: Can Use HP Filter. International Economic Review, 62(2), 521–570.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/bhp_filter.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Boosted HP Filter — bhp_filter","text":"","code":"# Quarterly GDP-like series y <- ts(cumsum(rnorm(200)), start = c(2000, 1), frequency = 4) result <- bhp_filter(y) print(result) #> -- MacroFilter [bHP] -- #>    Observations : 200 #>    Parameters   : lambda = 1600, iterations = 93, stopping_rule = bic #>    Cycle range  : [-1.728, 1.688]  sd = 0.6928 #>    Compute time : 0.018 s"},{"path":"https://michal0091.github.io/MacroFilters/reference/hamilton_filter.html","id":null,"dir":"Reference","previous_headings":"","what":"Hamilton Filter — hamilton_filter","title":"Hamilton Filter — hamilton_filter","text":"Decomposes time series trend cycle components using regression-based filter proposed Hamilton (2018). trend fitted value OLS regression \\(y_{t+h}\\) \\((1, y_t, y_{t-1}, \\ldots, y_{t-p+1})\\), cycle residual.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/hamilton_filter.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Hamilton Filter — hamilton_filter","text":"","code":"hamilton_filter(x, h = NULL, p = 4L)"},{"path":"https://michal0091.github.io/MacroFilters/reference/hamilton_filter.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Hamilton Filter — hamilton_filter","text":"x Numeric vector, ts, xts, zoo object. h Integer horizon (number periods ahead). NULL (default), auto-detected series frequency using Hamilton's rule: annual = 2, quarterly = 8, monthly = 24. p Integer number lags regression (default 4).","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/hamilton_filter.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Hamilton Filter — hamilton_filter","text":"macrofilter object trend, cycle, data, meta components. meta includes h, p, coefficients, compute_time.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/hamilton_filter.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Hamilton Filter — hamilton_filter","text":"Hamilton (2018) proposes replacing HP filter simple regression: $$y_{t+h} = \\beta_0 + \\beta_1 y_t + \\beta_2 y_{t-1} + \\cdots +   \\beta_p y_{t-p+1} + v_{t+h}$$ fitted values \\(\\hat{y}_{t+h}\\) define trend residuals \\(\\hat{v}_{t+h}\\) define cycle. first \\(h + p - 1\\) observations computable trend cycle filled NA. lag matrix constructed vectorized via embed() regression solved stats::lm.fit() speed.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/hamilton_filter.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Hamilton Filter — hamilton_filter","text":"Hamilton, J.D. (2018). Never Use Hodrick-Prescott Filter. Review Economics Statistics, 100(5), 831–843.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/hamilton_filter.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Hamilton Filter — hamilton_filter","text":"","code":"# Quarterly GDP-like series y <- ts(cumsum(rnorm(200)), start = c(2000, 1), frequency = 4) result <- hamilton_filter(y) print(result) #> -- MacroFilter [Hamilton] -- #>    Observations : 200 #>    Parameters   : h = 8, p = 4 #>    Cycle range  : [-5.501, 6.003]  sd = 2.437 #>    Compute time : 0.000 s"},{"path":"https://michal0091.github.io/MacroFilters/reference/hp_filter.html","id":null,"dir":"Reference","previous_headings":"","what":"Hodrick-Prescott Filter (Sparse Matrix Implementation) — hp_filter","title":"Hodrick-Prescott Filter (Sparse Matrix Implementation) — hp_filter","text":"Decomposes time series trend cycle components solving HP penalized least-squares problem using sparse Cholesky factorization. avoids dense O(n^3) inversion used implementations scales linearly number observations.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/hp_filter.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Hodrick-Prescott Filter (Sparse Matrix Implementation) — hp_filter","text":"","code":"hp_filter(x, lambda = NULL, freq = NULL)"},{"path":"https://michal0091.github.io/MacroFilters/reference/hp_filter.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Hodrick-Prescott Filter (Sparse Matrix Implementation) — hp_filter","text":"x Numeric vector, ts, xts, zoo object. lambda Smoothing parameter. NULL (default), auto-detected using Ravn-Uhlig rule (6.25 * freq^4). freq Numeric frequency override (1 = annual, 4 = quarterly, 12 = monthly). Used lambda NULL frequency inferred x.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/hp_filter.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Hodrick-Prescott Filter (Sparse Matrix Implementation) — hp_filter","text":"macrofilter object trend, cycle, data, meta components.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/hp_filter.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Hodrick-Prescott Filter (Sparse Matrix Implementation) — hp_filter","text":"HP filter minimises $$\\sum (y_t - \\tau_t)^2 + \\lambda \\sum (\\Delta^2 \\tau_t)^2$$ admits closed-form solution $$(+ \\lambda D'D)\\,\\tau = y$$ \\(D\\) second-difference operator. implementation builds \\(D\\) banded sparse matrix (Matrix::bandSparse()) solves symmetric positive-definite system sparse Cholesky decomposition (Matrix::solve()). lambda supplied Ravn-Uhlig (2002) rule applied: lambda = 6.25 * freq^4, yielding 6.25 (annual), 1600 (quarterly), 129 600 (monthly).","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/hp_filter.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Hodrick-Prescott Filter (Sparse Matrix Implementation) — hp_filter","text":"Hodrick, R.J. Prescott, E.C. (1997). Postwar U.S. Business Cycles: Empirical Investigation. Journal Money, Credit Banking, 29(1), 1–16. Ravn, M.O. Uhlig, H. (2002). Adjusting Hodrick-Prescott Filter Frequency Observations. Review Economics Statistics, 84(2), 371–376.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/hp_filter.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Hodrick-Prescott Filter (Sparse Matrix Implementation) — hp_filter","text":"","code":"# Quarterly GDP-like series y <- ts(cumsum(rnorm(200)), start = c(2000, 1), frequency = 4) result <- hp_filter(y) print(result) #> -- MacroFilter [HP] -- #>    Observations : 200 #>    Parameters   : lambda = 1600 #>    Cycle range  : [-2.878, 3.83]  sd = 1.387 #>    Compute time : 0.003 s"},{"path":"https://michal0091.github.io/MacroFilters/reference/mbh_filter.html","id":null,"dir":"Reference","previous_headings":"","what":"MacroBoost Hybrid (MBH) Filter — mbh_filter","title":"MacroBoost Hybrid (MBH) Filter — mbh_filter","text":"Decomposes time series trend cycle using robust boosting algorithm. Unlike HP filter, MBH uses Huber loss function automatically downweight outliers (like COVID-19 shock), preventing distorting trend.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/mbh_filter.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"MacroBoost Hybrid (MBH) Filter — mbh_filter","text":"","code":"mbh_filter(   x,   knots = NULL,   mstop = 500L,   d = NULL,   nu = 0.1,   df = 4L,   select_mstop = FALSE )"},{"path":"https://michal0091.github.io/MacroFilters/reference/mbh_filter.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"MacroBoost Hybrid (MBH) Filter — mbh_filter","text":"x Numeric vector, ts, xts, zoo object. knots Integer. Number interior knots P-Spline. NULL (default), calculated max(20, floor(n / 2)). High knot density required trend flexible enough. mstop Integer. Maximum number boosting iterations (default 500). select_mstop = TRUE upper bound; actual stopping point chosen AICc. d Numeric NULL. delta parameter Huber loss. NULL (default), auto-calibrated Median Absolute Deviation (MAD) first differences series (mad(diff(y))). Scale-mismatch warning: x log-level series, diff(y) returns inter-period growth rates (typical scale 0.001–0.02), whereas output gap (residual filter must explain) much larger scale (typical scale 0.01–0.05). Using mad(diff(y)) d therefore sets Huber threshold far low: filter treats normal business-cycle oscillations outliers, truncates gradients, blocks learning. trend becomes -smooth cycle absorbs much long-run variance. Recommendation: quick preliminary calibration use d = mad(hp_filter(x)$cycle), sets threshold residual scale. Supply explicit numeric value override automatic fallback entirely. nu Numeric. learning rate (shrinkage) boosting (default 0.1). df Integer. Effective degrees freedom per boosting step P-Spline base learner (default 4). enforces weak-learner constraint Bühlmann & Hothorn (2007): boosting step contributes small, smooth update trend built gradually many iterations rather fitted one pass. End-point instability warning: Higher df values cause B-spline basis matrix shift drastically sample size changes even one observation (\"rubber-band effect\"). last data points pull estimated trend non-smoothly, producing unreliable end--sample estimates. Keep df = 4 (default) unless specific reason deviate. select_mstop Logical. TRUE, optimal number boosting iterations selected automatically via AICc (corrected AIC), following Bühlmann & Hothorn (2007). mstop argument acts search upper bound. Default FALSE. AICc underfitting warning: combination Huber quasi-likelihood + P-splines, AICc penalises model complexity hyper-aggressively. practice algorithm stops iteration ~5–15 instead intended ~500. resulting trend nearly straight line; long-run variance pushed cycle component, defeating purpose filter. Treat select_mstop = TRUE experimental option validate visually relying .","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/mbh_filter.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"MacroBoost Hybrid (MBH) Filter — mbh_filter","text":"macrofilter object trend, cycle, data, meta components.  meta list contains method = \"MBH\", knots, d, mstop, nu, df, select_mstop, compute_time.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/mbh_filter.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"MacroBoost Hybrid (MBH) Filter — mbh_filter","text":"model estimated additive model: $$y_t = \\text{Linear}(t) + \\text{Smooth}(t) + \\epsilon_t$$ fitted using mboost::mboost() : Base Learners: linear time trend (mboost::bols()) capture global path, plus B-spline (mboost::bbs()) capture local curvature. Loss Function: Huber loss (mboost::Huber()) parameter d.  key robustness. default parameters (knots = n/2, mstop = 500) calibrated mimic flexibility standard HP filter retaining robustness Huber loss.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/mbh_filter.html","id":"calibration-guidance","dir":"Reference","previous_headings":"","what":"Calibration Guidance","title":"MacroBoost Hybrid (MBH) Filter — mbh_filter","text":"Three failure modes discovered empirical stress-testing. defaults guard three: 1. Huber delta scale mismatch (d) automatic fallback mad(diff(y)) operates scale growth rates, output gap. log-level input sets d one two orders magnitude small, causing ordinary business-cycle swings treated outliers. estimated cycle looks implausibly large trend nearly linear, override d = mad(hp_filter(x)$cycle) starting point. 2. AICc underfitting (select_mstop) AICc + Huber quasi-likelihood + P-splines stops boosting iteration ~5–15. trend degenerates near-straight line cycle absorbs long-run variance. Leave select_mstop = FALSE (default) set mstop explicitly instead. 3. End-point instability (df) Values 4 shift B-spline basis matrix non-smoothly sample grows, producing \"rubber-band\" distortion final observations. Keep df = 4 (default) real-time applications.","code":""},{"path":"https://michal0091.github.io/MacroFilters/reference/mbh_filter.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"MacroBoost Hybrid (MBH) Filter — mbh_filter","text":"","code":"# Quarterly GDP-like series set.seed(42) y <- ts(cumsum(rnorm(200)), start = c(2000, 1), frequency = 4) result <- mbh_filter(y) print(result) #> -- MacroFilter [MBH] -- #>    Observations : 200 #>    Parameters   : knots = 100, d = 0.9445, mstop = 500, mstop_initial = 500, nu = 0.1, df = 4, select_mstop = FALSE #>    Cycle range  : [-4.17, 5.05]  sd = 1.721 #>    Compute time : 0.204 s"}]
